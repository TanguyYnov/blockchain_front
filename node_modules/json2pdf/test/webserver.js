#!/usr/bin/env node


var http = require('http');
var moment = require('moment');
var PDFDocument = require('pdfkit');	
var fs = require('fs');
//~ var request = require('request');
var url = require('url');

var j2pdf = require('json2pdf');

http.createServer(function (req, res) {
	//~ res.writeHead(200, {'Content-Type': 'text/plain'});
	//~ var url="http://192.168.137.116:8000/private/scr?scr=sales-tt-day-hour";
	//~ request(url, function(error, response, body) {
		//~ if (!error && response.statusCode == 200) {
			//~ var data= JSON.parse(body);
	var u= url.parse(req.url);
	if ((u.path !== '/') && (u.path !== '/favicon.ico')) {
		
		fs.readFile(u.path.substr(1), function(error,fileData) {
				if (error) {
					//~ throw error;
					res.end('error, not found');
				}
				else {
					var data= JSON.parse(fileData);
					var sett= {layout: 'landscape',size:'A4',margin_top: 0};
					//~ var tmpfile = fs.createWriteStream('tmp.pdf');
					var tmpfile = res;
					j2pdf(sett, data, tmpfile, function(page,all) {
						//~ console.log('%d/%d',page,all);
					});
				}
		});  	
	}
}).listen(1337);
console.log('PDF Server running at http://127.0.0.1:1337/');

//~ fs.readFile('data3', function(err,fileData) {
	//~ var data= JSON.parse(fileData);
	//~ var sett= {layout: 'landscape',size:'A4'};
	//~ var str = fs.createWriteStream('actual.pdf');
	//~ console.log('start');
	//~ j2pdf(sett,data,str,function(page,all) {
		//~ console.log('%d/%d',page,all);
	//~ });
//~ });



